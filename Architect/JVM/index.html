<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JVM java虚拟机 | 胖杯的学习笔记</title>
    <meta name="description" content="临渊羡鱼，不如退而结网。">
    <link rel="icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.26516266.css" as="style"><link rel="preload" href="/assets/js/app.71a518ec.js" as="script"><link rel="preload" href="/assets/js/4.3df45311.js" as="script"><link rel="prefetch" href="/assets/js/10.6a119389.js"><link rel="prefetch" href="/assets/js/11.f9c278a6.js"><link rel="prefetch" href="/assets/js/12.fb97b57a.js"><link rel="prefetch" href="/assets/js/13.e3315aca.js"><link rel="prefetch" href="/assets/js/14.7edf6ab8.js"><link rel="prefetch" href="/assets/js/2.071f4b9a.js"><link rel="prefetch" href="/assets/js/3.50a25f29.js"><link rel="prefetch" href="/assets/js/5.fc588892.js"><link rel="prefetch" href="/assets/js/6.e2f9e04f.js"><link rel="prefetch" href="/assets/js/7.5daf229f.js"><link rel="prefetch" href="/assets/js/8.2af3125f.js"><link rel="prefetch" href="/assets/js/9.7d4bb664.js">
    <link rel="stylesheet" href="/assets/css/0.styles.26516266.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">胖杯的学习笔记</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/guide/Notes/" class="nav-link">笔记</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java架构师</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Architect/Interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/Architect/Pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/Architect/JVM/" class="nav-link router-link-exact-active router-link-active">JVM</a></li></ul></div></div><div class="nav-item"><a href="/TechnicalCourse/" class="nav-link">技术教程</a></div> <a href="https://github.com/BennyYEE/BennyYEE.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/guide/Notes/" class="nav-link">笔记</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Java架构师</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Architect/Interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/Architect/Pattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/Architect/JVM/" class="nav-link router-link-exact-active router-link-active">JVM</a></li></ul></div></div><div class="nav-item"><a href="/TechnicalCourse/" class="nav-link">技术教程</a></div> <a href="https://github.com/BennyYEE/BennyYEE.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>JVM</span> <!----></p> <ul class="sidebar-group-items"></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="jvm-java虚拟机"><a href="#jvm-java虚拟机" aria-hidden="true" class="header-anchor">#</a> JVM java虚拟机</h2> <h2 id="_1、什么是jvm？"><a href="#_1、什么是jvm？" aria-hidden="true" class="header-anchor">#</a> 1、什么是JVM？</h2> <p>功能：</p> <p>1、软件层面机器码翻译：帮程序员从软层面把我们认识的代码指令翻译成机器指令</p> <p>2、内存管理</p> <h2 id="_2、jvm运行时数据区"><a href="#_2、jvm运行时数据区" aria-hidden="true" class="header-anchor">#</a> 2、JVM运行时数据区</h2> <h3 id="native-interface-本地接口"><a href="#native-interface-本地接口" aria-hidden="true" class="header-anchor">#</a> Native Interface 本地接口</h3> <p>​	本地接口的作用是融合不同的编程语言为Java所用。</p> <h3 id="native-method-stack-本地方法栈"><a href="#native-method-stack-本地方法栈" aria-hidden="true" class="header-anchor">#</a> Native Method Stack 本地方法栈</h3> <p>​	它的具体做法是Native Method Stack 中登记native方法，在Execution Engine 执行时加载本地方法库。</p> <h3 id="pc寄存器"><a href="#pc寄存器" aria-hidden="true" class="header-anchor">#</a> PC寄存器</h3> <p>​	每个线程都有一个程序计数器，是线程私有的，就是一个指针，指向方法区中的方法字节码（用来存储指向下一条指令的地址，即：将要执行的指令代码），由执行引擎读取下一条指令，是一个非常小的内存空间，几乎可以忽略不计。</p> <h3 id="程序计数器"><a href="#程序计数器" aria-hidden="true" class="header-anchor">#</a> 程序计数器</h3> <p>​	指向当前线程正在执行的字节码指令的地址 行号</p> <h3 id="虚拟机栈"><a href="#虚拟机栈" aria-hidden="true" class="header-anchor">#</a> 虚拟机栈</h3> <p>​	存储当前线程运行方法是所需要的数据、指令和返回地址</p> <p>​	栈桢：一个方法对应一个栈桢</p> <h3 id="method-area-方法区"><a href="#method-area-方法区" aria-hidden="true" class="header-anchor">#</a> Method Area 方法区</h3> <p>​	方法区是被所有线程共享，所有字段和方法字节码，以及一些特殊方法如构造函数，接口代码也在此定义。</p> <p>​	简单说，所有定义方法的信息都保存在该区域，此区属于共享区间。</p> <p>​	静态变量、常量、类信息（构造方法/接口定义）、运行时常量池 存在方法区中。</p> <h2 id="_3、内存模型jmm"><a href="#_3、内存模型jmm" aria-hidden="true" class="header-anchor">#</a> 3、内存模型JMM</h2> <p>​	对象的生命周期不一样，所以需要分代</p> <p>​	新生代</p> <p>​		98%的对象在minor gc的时候会被回收掉，基于复制回收算法，为了提高内存利用率，所以设置了8:1:1的 eden区、s0区 和 s1区，这样就有90%的内存空间能被使用</p> <p>​	老年代</p> <p>​	原空间（Meta Space JDK1.8）永久代（&lt;JDK1.8）</p> <p>​	什么样的对象需要被GC</p> <p>​		判断算法
​			— 引用计数器</p> <p>​			— 可达性分析</p> <p>​				哪些对象能成为GC Root</p> <p>​					虚拟机栈中：本地变量表引用的对象</p> <p>​					方法区中：类静态变量引用的对象、常量引用的对象</p> <p>​					本地方法栈中：JNI引用的对象</p> <p>​</p> <p>​			— 不可达是不是一定会被回收？不</p> <p>​				finalize() 看此方法中还会不会对该对象进行挽救，让其可达。但尽量不要去挽救</p> <p>​	对象分配eden</p> <p>​	-XX:SurvivorRatio=8	8:1:1</p> <p>​</p> <p>​	TLAB  Thread Local Allaction Buffer</p> <p>​	对象很大</p> <p>​		-XX:PretenureSizeThreshold=3145728	3M</p> <p>​	长期存活的对象</p> <p>​		-XX:MaxTenuringThreshold=15	默认是15，一次Minor GC是一岁</p> <p>​	动态对象年龄判定</p> <p>​		相同年龄所有对象的大小总和  &gt;  Survivor空间的一半</p> <p>​	分配担保</p> <p>​		Minor GC 之前检查</p> <p>​		老年代最大可用连续空间是否&gt;新生代所有对象总空间</p> <p>​	Minor GC  + Major GC = Full GC</p> <p>什么样的对象需要回收？</p> <p>判断算法</p> <p>引用</p> <p>​	强：Object object = new Object();</p> <p>​	软：判断内存空间不够时才回收</p> <p>​	弱：只要GC 就会回收</p> <p>​	虚：引用时会被通知</p> <h2 id="_4、垃圾收集器"><a href="#_4、垃圾收集器" aria-hidden="true" class="header-anchor">#</a> 4、垃圾收集器</h2> <p>垃圾回收</p> <p>​	方法论：</p> <p>​		标记-清除算法</p> <p>​		复制回收算法</p> <p>​		标记-整理算法</p> <p>​	垃圾收集器</p> <p>​		STW	Stop The World</p> <p>​		Serial</p> <p>​		ParNew</p> <p>​			-XX:ParallelGCThreads</p> <p>​		Parallel Scavenge(全局)</p> <p>​			吞吐量 = 运行用户代码时间 / （运行用户代码时间 + 垃圾收集时间）</p> <p>​			-XX:MaxGcPauseMillis=n</p> <p>​			-XX:GCTimeRetio=n</p> <p>​			-XX:UseAdaptiveSizePolicy	GC	Ergonomics</p> <p>​		Serial Old</p> <p>​			标记-整理算法</p> <p>​			CMS备用预案	Concurrent Mode Failure时使用</p> <p>​		Parallel Old</p> <p>​			标记-整理算法</p> <p>​		CMS</p> <p>​			标记-清除算法</p> <p>​			减少回收停顿时间</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/BennyYEE/BennyYEE.github.io/edit/master/docs/Architect/JVM/README.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.71a518ec.js" defer></script><script src="/assets/js/4.3df45311.js" defer></script>
  </body>
</html>
